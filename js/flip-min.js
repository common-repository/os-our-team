(function($){var flip=function($dom,callback){$dom.data("flipped",true);var rotateAxis="rotate"+$dom.data("axis");$dom.find($dom.data("front")).css({transform:rotateAxis+($dom.data("reverse")?"(-180deg)":"(180deg)"),"z-index":"0"});$dom.find($dom.data("back")).css({transform:rotateAxis+"(0deg)","z-index":"1"});$dom.one(whichTransitionEvent(),function(){$(this).trigger('flip:done');if(callback!==undefined){callback.call(this)}})};var unflip=function($dom,callback){$dom.data("flipped",false);var rotateAxis="rotate"+$dom.data("axis");$dom.find($dom.data("front")).css({transform:rotateAxis+"(0deg)","z-index":"1"});$dom.find($dom.data("back")).css({transform:rotateAxis+($dom.data("reverse")?"(180deg)":"(-180deg)"),"z-index":"0"});$dom.one(whichTransitionEvent(),function(){$(this).trigger('flip:done');if(callback!==undefined){callback.call(this)}})};var whichTransitionEvent=function(){var t,el=document.createElement("fakeelement"),transitions={"transition":"transitionend","OTransition":"oTransitionEnd","MozTransition":"transitionend","WebkitTransition":"webkitTransitionEnd"};for(t in transitions){if(el.style[t]!==undefined){return transitions[t]}}};$.fn.flip=function(options,callback){if(typeof options=='function'){callback=options}this.each(function(){var $dom=$(this);if(options!==undefined&&(typeof(options)=="boolean"||typeof(options)=="string")){if(options=="toggle"){options=!$dom.data("flipped")}if(options){flip($dom,callback)}else{unflip($dom,callback)}}else if(!$dom.data("initiated")){$dom.data("initiated",true);var settings=$.extend({axis:"y",reverse:false,trigger:"click",speed:500,forceHeight:false,forceWidth:false,autoSize:true,front:'auto',back:'auto'},options);if(settings.front=="auto"){settings.front=($dom.find('.front').length>0)?'.front':'div:first-child'}else if(settings.front=="autostrict"){settings.front='div:first-child'}if(settings.back=="auto"){settings.back=($dom.find('.back').length>0)?'.back':'div:first-child + div'}else if(settings.back=="autostrict"){settings.back='div:first-child + div'}$dom.data("reverse",settings.reverse);$dom.data("axis",settings.axis);$dom.data("front",settings.front);$dom.data("back",settings.back);var rotateAxis="rotate"+(settings.axis.toLowerCase()=="x"?"x":"y"),perspective=$dom["outer"+(rotateAxis=="rotatex"?"Height":"Width")]()*2;$dom.find($dom.data("back")).css({transform:rotateAxis+"("+(settings.reverse?"180deg":"-180deg")+")"});$dom.css({perspective:perspective,position:"relative"});var speedInSec=settings.speed/1000||0.5;var faces=$dom.find(settings.front).add(settings.back,$dom);if(settings.forceHeight){faces.outerHeight($dom.height())}else if(settings.autoSize){faces.css({'height':'100%'})}if(settings.forceWidth){faces.outerWidth($dom.width())}else if(settings.autoSize){faces.css({'width':'100%'})}faces.css({"backface-visibility":"hidden","transform-style":"preserve-3d",position:"absolute","z-index":"1"});faces.find('*').css({"backface-visibility":"hidden"});$dom.find($dom.data("back")).css({transform:rotateAxis+"("+(settings.reverse?"180deg":"-180deg")+")","z-index":"0"});if((window.chrome||(window.Intl&&Intl.v8BreakIterator))&&'CSS'in window){$dom.css({"-webkit-transform-style":"preserve-3d"})}setTimeout(function(){faces.css({transition:"all "+speedInSec+"s ease-out"});if(callback!==undefined){callback.call(this)}},20);if(settings.trigger.toLowerCase()=="click"){$dom.on($.fn.tap?"tap":"click",function(event){if(!event){event=window.event}if($dom.find($(event.target).closest('button, a, input[type="submit"]')).length){return}if($dom.data("flipped")){unflip($dom)}else{flip($dom)}})}else if(settings.trigger.toLowerCase()=="hover"){var performFlip=function(){$dom.unbind('mouseleave',performUnflip);flip($dom);setTimeout(function(){$dom.bind('mouseleave',performUnflip);if(!$dom.is(":hover")){unflip($dom)}},(settings.speed+150))};var performUnflip=function(){unflip($dom)};$dom.mouseenter(performFlip);$dom.mouseleave(performUnflip)}}else{if(options&&(options.axis!==undefined||options.reverse!==undefined)){changeSettings.call(this,options,function(){$dom.trigger('flip:change');if(callback!==undefined){callback.call(this)}})}}});return this};var changeSettings=function(options,callback){var changeNeeded=false;if(options.axis!==undefined&&$(this).data("axis")!=options.axis.toLowerCase()){$(this).data("axis",options.axis.toLowerCase());changeNeeded=true}if(options.reverse!==undefined&&$(this).data("reverse")!=options.reverse){$(this).data("reverse",options.reverse);changeNeeded=true}if(changeNeeded){var faces=$(this).find($(this).data("front")).add($(this).data("back"),$(this));var savedTrans=faces.css("transition");faces.css({transition:"none"});var rotateAxis="rotate"+$(this).data("axis");if($(this).data("flipped")){$(this).find($(this).data("front")).css({transform:rotateAxis+($(this).data("reverse")?"(-180deg)":"(180deg)"),"z-index":"0"})}else{$(this).find($(this).data("back")).css({transform:rotateAxis+"("+($(this).data("reverse")?"180deg":"-180deg")+")","z-index":"0"})}setTimeout(function(){faces.css({transition:savedTrans});callback.call(this)}.bind(this),0)}else{setTimeout(callback.bind(this),0)}}}(jQuery));